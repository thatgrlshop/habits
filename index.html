<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habit Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 14px;
      background-color: #f9f9f9;
      color: #333;
    }
    h1, h2 {
      text-align: center;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .calendar-header button {
      padding: 5px 10px;
      background-color: #A17E89;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .calendar-header button:hover {
      background-color: #8c6375;
    }
    .calendar-header span {
      font-size: 18px;
      font-weight: bold;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      justify-items: center;
      margin-bottom: 20px;
    }
    .day {
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      background-color: #fff;
    }
    .day:hover {
      background-color: #A17E89;
      color: white;
    }
    .day.active {
      background-color: #A17E89;
      color: white;
    }
    .habits {
      display: none;
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #fff;
    }
    .habit-item {
      margin-bottom: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #A17E89;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #8c6375;
    }
    .report {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #fff;
    }
    .habit-report {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .progress-bar {
      width: 70%;
      height: 10px;
      background-color: #ddd;
      border-radius: 5px;
      margin-left: 10px;
      position: relative;
    }
    .progress {
      height: 100%;
      background-color: #A17E89;
      border-radius: 5px;
      width: 0;
      transition: width 0.3s ease-in-out;
    }
    .edit-habits-modal {
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 20px;
      z-index: 1000;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
      display: none;
    }
  </style>
</head>
<body>
  <h1>Habit Tracker</h1>
  <div class="calendar-header">
    <button id="prev-month">❮</button>
    <span id="current-month"></span>
    <button id="next-month">❯</button>
  </div>
  <div class="calendar" id="calendar"></div>
  <div class="habits" id="habits">
    <h2 id="selected-date"></h2>
    <div id="habit-list"></div>
    <button id="save-habits">Save Habits</button>
    <button id="edit-habits">Edit Habits</button>
  </div>

  <!-- Modal for Editing Habits -->
  <div class="edit-habits-modal" id="edit-habits-modal">
    <h2>Edit Habits for <span id="current-month-title"></span></h2>
    <div class="habit-options">
      <label><input type="checkbox" class="habit-option" value="Water Intake" checked> Water Intake</label>
      <label><input type="checkbox" class="habit-option" value="Workout" checked> Workout</label>
      <label><input type="checkbox" class="habit-option" value="Read 10 Pages" checked> Read 10 Pages</label>
      <label><input type="checkbox" class="habit-option" value="Meditation"> Meditation</label>
      <label><input type="checkbox" class="habit-option" value="Stretching"> Stretching</label>
    </div>
    <button id="save-habit-changes">Save Changes</button>
  </div>

  <!-- Monthly Report -->
  <div class="report" id="report" style="display: none;">
    <h2>Monthly Report</h2>
    <div id="report-habits-list"></div>
  </div>

  <script>
    const calendar = document.getElementById("calendar");
    const habits = document.getElementById("habits");
    const selectedDateElement = document.getElementById("selected-date");
    const currentMonthElement = document.getElementById("current-month");
    const prevMonthButton = document.getElementById("prev-month");
    const nextMonthButton = document.getElementById("next-month");
    const report = document.getElementById("report");
    const showReportButton = document.getElementById("show-report");
    const editHabitsButton = document.getElementById("edit-habits");
    const editHabitsModal = document.getElementById("edit-habits-modal");
    const saveHabitChangesButton = document.getElementById("save-habit-changes");
    const habitList = document.getElementById("habit-list");
    const habitOptions = document.querySelectorAll(".habit-option");
    const currentMonthTitle = document.getElementById("current-month-title");

    let currentDate = new Date();

  // Generazione del calendario
function generateCalendar() {
  calendar.innerHTML = "";
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const firstDayIndex = new Date(year, month, 1).getDay();

  currentMonthElement.textContent = `${currentDate.toLocaleString("default", { month: "long" })} ${year}`;

  for (let i = 0; i < firstDayIndex; i++) {
    const emptyDiv = document.createElement("div");
    calendar.appendChild(emptyDiv);
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const dayElement = document.createElement("div");
    dayElement.classList.add("day");
    dayElement.textContent = day;
    dayElement.addEventListener("click", () => selectDay(day));
    calendar.appendChild(dayElement);
  }
}

// Selezione del giorno
function selectDay(day) {
  const allDays = document.querySelectorAll(".day");
  allDays.forEach((d) => d.classList.remove("active"));
  const selectedDay = [...allDays].find((d) => d.textContent == day);
  selectedDay.classList.add("active");

  const date = `${day} ${currentDate.toLocaleString("default", { month: "long" })} ${currentDate.getFullYear()}`;
  selectedDateElement.textContent = date;
  habits.style.display = "block";

  loadDailyHabits(); // Carica le abitudini giornaliere
  loadHabits(date); // Carica i dati salvati per quel giorno
}

// Caricamento delle abitudini giornaliere
function loadDailyHabits() {
  habitList.innerHTML = "";
  const currentMonth = currentMonthElement.textContent;
  const monthlyHabits = JSON.parse(localStorage.getItem(`monthlyHabits-${currentMonth}`)) || [];
  monthlyHabits.forEach((habit) => {
    const habitItem = document.createElement("div");
    habitItem.classList.add("habit-item");
    habitItem.innerHTML = `
      <label>${habit}:</label>
      <input type="checkbox" id="${habit.replace(/\s+/g, '-').toLowerCase()}">
    `;
    habitList.appendChild(habitItem);
  });
}

// Salvataggio delle abitudini giornaliere
document.getElementById("save-habits").addEventListener("click", () => {
  const day = selectedDateElement.textContent;
  const currentMonth = currentMonthElement.textContent;
  const monthlyHabits = JSON.parse(localStorage.getItem(`monthlyHabits-${currentMonth}`)) || [];
  const habitsData = {};

  monthlyHabits.forEach((habit) => {
    const habitId = habit.replace(/\s+/g, '-').toLowerCase();
    const habitCheckbox = document.getElementById(habitId);
    habitsData[habit] = habitCheckbox && habitCheckbox.checked;
  });

  const existingData = JSON.parse(localStorage.getItem("habitTracker")) || {};
  if (!existingData[currentMonth]) existingData[currentMonth] = {};
  existingData[currentMonth][day] = habitsData;

  localStorage.setItem("habitTracker", JSON.stringify(existingData));
  alert("Habits saved! ✨");
});

// Caricamento dei dati salvati per un giorno
function loadHabits(date) {
  const savedHabits = JSON.parse(localStorage.getItem("habitTracker")) || {};
  const [day, month, year] = date.split(" ");
  const habitsData = savedHabits[`${month} ${year}`]?.[day] || {};
  const currentMonth = currentMonthElement.textContent;
  const monthlyHabits = JSON.parse(localStorage.getItem(`monthlyHabits-${currentMonth}`)) || [];

  monthlyHabits.forEach((habit) => {
    const habitId = habit.replace(/\s+/g, '-').toLowerCase();
    const habitCheckbox = document.getElementById(habitId);
    if (habitCheckbox) {
      habitCheckbox.checked = habitsData[habit] || false;
    }
  });
}

// Report mensile
showReportButton.addEventListener("click", () => {
  const currentMonth = currentMonthElement.textContent;
  const savedHabits = JSON.parse(localStorage.getItem(`monthlyHabits-${currentMonth}`)) || [];
  const monthData = JSON.parse(localStorage.getItem("habitTracker"))?.[currentMonth] || {};

  const reportHabitsList = document.getElementById("report-habits-list");
  reportHabitsList.innerHTML = "";

  savedHabits.forEach((habit) => {
    let habitTotal = 0;
    let habitMax = 0;

    Object.keys(monthData).forEach((day) => {
      if (monthData[day][habit]) {
        habitTotal += Array.isArray(monthData[day][habit])
          ? monthData[day][habit].filter(Boolean).length
          : 1;
        habitMax += Array.isArray(monthData[day][habit]) ? 4 : 1;
      }
    });

    const habitProgress = (habitTotal / (habitMax || 1)) * 100;
    const habitReportItem = `
      <div class="habit-report">
        <label>${habit}:</label>
        <div class="progress-bar">
          <div class="progress" style="width: ${habitProgress}%;"></div>
        </div>
      </div>
    `;
    reportHabitsList.innerHTML += habitReportItem;
  });

  report.style.display = "block";
});

// Modifica delle abitudini mensili
editHabitsButton.addEventListener("click", () => {
  currentMonthTitle.textContent = currentMonthElement.textContent;
  editHabitsModal.style.display = "block";
  loadMonthlyHabits();
});

// Salvataggio delle modifiche alle abitudini mensili
saveHabitChangesButton.addEventListener("click", () => {
  const currentMonth = currentMonthElement.textContent;
  const selectedHabits = Array.from(habitOptions)
    .filter((option) => option.checked)
    .map((option) => option.value);

  localStorage.setItem(`monthlyHabits-${currentMonth}`, JSON.stringify(selectedHabits));
  alert("Habit settings saved for this month! ✨");
  editHabitsModal.style.display = "none";

  loadDailyHabits();
});

// Caricamento delle abitudini mensili
function loadMonthlyHabits() {
  const currentMonth = currentMonthElement.textContent;
  const savedHabits = JSON.parse(localStorage.getItem(`monthlyHabits-${currentMonth}`)) || ["Water Intake", "Workout", "Read 10 Pages"];
  habitOptions.forEach((option) => {
    option.checked = savedHabits.includes(option.value);
  });
}

// Navigazione tra i mesi
prevMonthButton.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  generateCalendar();
  loadDailyHabits();
});

nextMonthButton.addEventListener("click", () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  generateCalendar();
  loadDailyHabits();
});

// Inizializzazione
function initializeHabits() {
  generateCalendar();
  loadDailyHabits();
}

initializeHabits();
  </script>
</body>
</html>
